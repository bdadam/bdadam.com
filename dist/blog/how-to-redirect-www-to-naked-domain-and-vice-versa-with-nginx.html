<!doctype html><html lang="en"><head><meta charset="utf-8"><title>How to redirect www to naked domain and vice versa with NGINX?</title><meta name="description" content="Redirection www to non-www and vice versa with NGINX"><meta property="og:description" content="One thing almost every website needs is redirection. Many websites decide to serve their visitors both over www and non-www site, just in case the user types it into the browser. But for SEO it&#x27;s bad, when you have the same site over two different domains. Here is, how to solve this issue with NGINX."><script>!function(){function a(a){var b=document.createElement("style");b.textContent=a,b.rel="stylesheet",document.head.appendChild(b)}try{if(localStorage.sourceSansPro)a(localStorage.sourceSansPro);else{var b=new XMLHttpRequest;b.open("GET","/static/source-sans-pro.woff.css",!0),b.onload=function(){b.status>=200&&b.status<400&&(localStorage.sourceSansPro=b.responseText,a(b.responseText))},b.send()}}catch(c){}}();</script><style>*{-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box;padding:0;margin:0}html{font-size:100%}body{font-size:1.375rem;font-family:Source Sans Pro,sans-serif;line-height:1.46;color:#333}ul,ol{list-style-position:inside;padding-bottom:12px}p{margin-bottom:12px}strong{font-weight:600}.container{margin:0 auto;padding:0 20px}@media screen and min-width (34em){.container{padding:0}}.main{max-width:34em}h1,h2,h3,h4,h5,h6{line-height:1.2;margin:.6em 0 .3em;font-weight:600}h1{font-size:2.5rem;margin-top:0}h2{font-size:2rem}hr{margin-top:20px;margin-bottom:20px;border:0;border-top:1px solid #eee;height:0}img{max-width:100%}iframe{width:100%;border:0}a{text-decoration:none;color:#428bca}a:hover,a:active{text-decoration:underline;color:#2a6496}pre{max-width:100%;overflow-x:auto;padding:0;background-color:transparent}pre code{padding:.5em;display:block}.silent{color:#999;font-size:1rem}.center{text-align:center}button{padding:4px;font-size:1rem}small{color:#999;font-size:1rem}.menu-icon{position:relative;float:right;top:-3px;width:4em;text-align:center}.menu-icon span{background-color:#f1f1f1;border:1px solid #999;border-radius:4px;padding:3px 8px;color:#333}nav{display:block;position:relative;background-color:#34495E;vertical-align:middle;text-transform:uppercase}nav .brand{font-weight:600;font-size:1.25rem}nav #menu{display:none}nav #menu a{display:block}nav a{color:#fff;line-height:1;display:inline-block;vertical-align:middle;padding:1rem 0}nav a:hover,nav a:active{color:#fff}.btn-readmore{display:block;text-align:center;padding:5px 12px;border-radius:4px;background-color:#0095d5;color:#fff;text-transform:uppercase}.btn-readmore:hover{text-decoration:none;background-color:#0071a2;color:#fff}.btn-readmore:active{text-decoration:none;background-color:#004e6f;color:#fff}footer{padding:24px 0;text-align:center;background-color:#f1f1f1;border-top:1px solid #ddd;margin-top:32px}.share-bar{margin-top:12px;padding:12px 0;border-top:1px solid #dedede;border-bottom:1px solid #dedede;line-height:1;text-align:center}.btn-share{padding:6px 12px;display:inline-block;margin:8px;font-size:1rem;vertical-align:text-bottom}.btn-share:link,.btn-share:visited,.btn-share:hover,.btn-share:active{color:#fff;text-decoration:none}.btn-share:hover,.btn-share:active{box-shadow:1px 1px 2px rgba(0,0,0,.85);box-shadow:0 0 3px rgba(127,127,127,.65)}.btn-share .fa{font-size:14px;padding-right:3px;border-right:1px solid #fff;vertical-align:text-bottom}.btn-share.fb{background-color:#3b5998}.btn-share.tw{background-color:#00aced}.btn-share.li{background-color:#007bb6}.btn-share.gp{background-color:#dd4b39}.btn-share.cm{background-color:#959}h1.site-title{position:absolute;bottom:8px;text-align:center;width:100%;font-size:2rem;margin:0}h2{font-weight:600}h2 a,h2 a:link,h2 a:visited,h2 a:hover,h2 a:active{color:#333}.full-post{margin-top:24px}.index-head{position:relative;height:280px;border-bottom:1px solid #dedede;background-image:url(/static/img/bg_480.jpg);background-position:center top;background-repeat:no-repeat}.abstract{font-weight:600}.article-image{display:block;border:1px solid #dedede;margin:0 auto}@media screen and (min-width:768px){.article-image{float:right;display:inline-block;margin-left:20px;margin-bottom:12px}}.social-links{display:block}@media screen and (min-width:480px){.index-head{background-image:url(/static/img/bg_1024.jpg)}}@media screen and (min-width:768px){nav .menu-icon{display:none}nav #menu{display:inline-block}nav #menu a{display:inline-block;margin-left:32px}}@media screen and (min-width:1024px){.index-head{background-image:url(/static/img/bg_1920.jpg)}}</style><link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/bdadamcom"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Adam Beres-Deak"><meta name="viewport" content="width=device-width"><link rel="apple-touch-icon" sizes="57x57" href="/static/img/favico/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="114x114" href="/static/img/favico/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="72x72" href="/static/img/favico/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="144x144" href="/static/img/favico/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="60x60" href="/static/img/favico/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="120x120" href="/static/img/favico/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="76x76" href="/static/img/favico/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="152x152" href="/static/img/favico/apple-touch-icon-152x152.png"><link rel="icon" type="image/png" href="/static/img/favico/favicon-196x196.png" sizes="196x196"><link rel="icon" type="image/png" href="/static/img/favico/favicon-160x160.png" sizes="160x160"><link rel="icon" type="image/png" href="/static/img/favico/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/png" href="/static/img/favico/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/static/img/favico/favicon-16x16.png" sizes="16x16"><meta name="msapplication-TileColor" content="#aa2211"><meta name="msapplication-TileImage" content="/static/img/favico/mstile-144x144.png"></head><body><nav><div class="container main"><a class="brand" href="/">bdadam.com</a> <a class="menu-icon" href="#"><span class="menu-icon">menu</span></a><div id="menu"><a href="/javascript-goodies.html">JavaScript Goodies</a> <a href="/about.html">Contact</a></div></div></nav><article class="container main full-post"><h1>How to redirect www to naked domain and vice versa with NGINX?</h1><p class="silent">3rd February 2014 | by <a href="/about.html">Adam Beres-Deak</a> | <i class="fa fa-tags"></i> nginx, redirection</p><div class="abstract"><p>One thing almost every website needs is redirection. Many websites decide to serve their visitors both over www and non-www site, just in case the user types it into the browser. But for SEO it&#x27;s bad, when you have the same site over two different domains. Here is, how to solve this issue with NGINX.</p></div><h2 id="redirecting-www-to-non-www-with-if-statement">Redirecting www to non-www with <code>if</code> statement</h2><pre><code class="language-nginx"><span class="title">server</span> {
    <span class="title">listen</span> <span class="number">80</span>;

    <span class="title">server_name</span> www.example.com example.com;

    <span class="title">if</span> (<span class="variable">$host</span> = <span class="string">'www.example.com'</span> ) {
        <span class="comment"># redirecting www.example.com to example.com</span>
        <span class="comment"># path, query string are retained</span>
        <span class="title">rewrite</span> <span class="regexp"> ^/(.*)$</span>  <span class="url">http://example.com/$1</span>  <span class="built_in">permanent</span>;
    }
}</code></pre><p>Please note that <code>if</code> is <a href="http://wiki.nginx.org/IfIsEvil" rel="external,nofollow">considered evil</a> inside NGINX configuration, but it is perfectly OK in this case. The official docs say, that there are two cases when <code>if</code> is &quot;100% safe&quot;:</p><ul><li>redirect (our case)</li><li>return</li></ul><pre><code class="language-nginx"><span class="title">if</span> (<span class="variable">$request_method</span> = POST ) {
    <span class="title">return</span> <span class="number">405</span>;
}
<span class="title">if</span> (<span class="variable">$args</span> <span class="regexp">~ post=140)</span>{
    <span class="title">rewrite</span><span class="regexp"> ^</span> <span class="url">http://example.com/</span> <span class="built_in">permanent</span>;
}</code></pre><h2 id="redirecting-www-to-non-www-without-if-statement">Redirecting www to non-www without <code>if</code> statement</h2><p>The trick in this case is that we have to define two server blocks.</p><pre><code class="language-nginx">server {
    listen       80;
    server_name  www.example.com;

    # redirecting www.example.com to example.com
    # path, query string are retained
    return       301 http://example.com$request_uri;
}

server {
    listen       80;
    server_name  example.com;
    ...
}</code></pre><h2 id="redirecting-non-www-to-www">Redirecting non-www to www</h2><pre><code class="language-nginx">server {
    listen       80;
    server_name  example.com;

    # redirecting example.com to www.example.com
    # path, query string are retained
    return       301 http://www.example.com$request_uri;
}

server {
    listen       80;
    server_name  www.example.com;
    ...
}</code></pre><p><a class="silent" href="https://plus.google.com/116380265342833844173?rel=author">by Adam Beres-Deak</a></p><p class="share-bar"></p><a id="comments"></a><div id="disqus_thread"></div><h4>Latest blog posts</h4><p><a href="/blog/loading-webfonts-with-high-performance.html">Loading webfonts with high performance on responsive websites <span class="muted"><small>8th October 2014</small></span></a></p><p><a href="/blog/optimistic-page-loading-with-instantclick-io.html">Loading web pages really fast - optimistic page loading with Instantclick.io <span class="muted"><small>8th October 2014</small></span></a></p><p><a href="/blog/generating-sound-effects-with-client-side-javascript.html">Generating sound effects with client side JavaScript <span class="muted"><small>6th April 2014</small></span></a></p><p><a href="/blog/static-site-generation-boilerplate.html">Boilerplate for static site generation <span class="muted"><small>25th March 2014</small></span></a></p><p><a href="/blog/automatically-loading-grunt-tasks-with-matchdep.html">Automatically loading Grunt tasks with matchdep <span class="muted"><small>11th March 2014</small></span></a></p></article><footer><p>Adam Beres-Deak &copy; 2014 <span class="social-links"><a href="mailto:me@bdadam.com"><i class="fa fa-envelope"></i></a>&nbsp;&nbsp; <a href="http://github.com/bdadam" rel="external,nofollow"><i class="fa fa-github"></i></a>&nbsp;&nbsp; <a href="https://twitter.com/bdadamm" rel="external,nofollow"><i class="fa fa-twitter"></i></a>&nbsp;&nbsp; <a href="https://www.xing.com/profile/Adam_BeresDeak" rel="external,nofollow"><i class="fa fa-xing"></i></a>&nbsp;&nbsp; <a href="https://plus.google.com/116380265342833844173?rel=author"><i class="fa fa-google-plus-square"></i></a></span> <a rel="external" href="http://feeds.feedburner.com/bdadamcom">RSS</a></p><p class="silent container">Except where otherwise noted, content on this site is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="external,noindex,nofollow">Creative Commons Attribution 4.0 International license</a>. Code samples are licensed under the MIT license.</p></footer><script data-no-instant>(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports=function(t,e){function n(t){var e=t.indexOf("#");return 0>e?t:t.substr(0,e)}function r(t){for(;"A"!=t.nodeName;)t=t.parentNode;return t}function i(t){do{if(!t.hasAttribute)break;if(t.hasAttribute("data-instant"))return!1;if(t.hasAttribute("data-no-instant"))return!0}while(t=t.parentNode);return!1}function a(t){do{if(!t.hasAttribute)break;if(t.hasAttribute("data-no-instant"))return!1;if(t.hasAttribute("data-instant"))return!0}while(t=t.parentNode);return!1}function o(t,e){for(var n=0;n<W[t].length;n++)W[t][n](e)}function s(e,r,i,a){if(t.title=e,t.documentElement.replaceChild(r,t.body),i){history.pushState(null,null,i);var s=i.indexOf("#"),d=s>-1&&t.getElementById(i.substr(s+1)),l=0;if(d)for(;d.offsetParent;)l+=d.offsetTop,d=d.offsetParent;scrollTo(0,l),T=n(i)}else scrollTo(0,a);m(),K.done(),o("change",!1)}function d(){I=!1,S=!1}function l(t){p(r(t.target).href)}function f(t){var e=r(t.target);e.addEventListener("mouseout",h),k?(E=e.href,w=setTimeout(p,k)):p(e.href)}function c(t){var e=r(t.target);x?e.removeEventListener("mousedown",l):e.removeEventListener("mouseover",f),p(e.href)}function u(t){t.which>1||t.metaKey||t.ctrlKey||(t.preventDefault(),g(r(t.target).href))}function h(){return w?(clearTimeout(w),void(w=!1)):void(I&&!S&&(L.abort(),d()))}function v(){if(!(L.readyState<4)&&0!=L.status){if(D.ready=+new Date-D.start,o("receive"),L.getResponseHeader("Content-Type").match(/\/(x|ht|xht)ml/)){var e=t.implementation.createHTMLDocument("");e.documentElement.innerHTML=L.responseText,O=e.title,N=e.body;var r=n(H);C[r]={body:N,title:O,scrollY:r in C?C[r].scrollY:0};for(var i,a,s=e.head.children,d=0,l=s.length-1;l>=0;l--)if(i=s[l],i.hasAttribute("data-instant-track")){a=i.getAttribute("href")||i.getAttribute("src")||i.innerHTML;for(var f=z.length-1;f>=0;f--)z[f]==a&&d++}d!=z.length&&(B=!0)}else B=!0;S&&(S=!1,g(H))}}function m(r){for(var o,s=t.getElementsByTagName("a"),d=e.protocol+"//"+e.host,h=s.length-1;h>=0;h--)o=s[h],o.target||o.hasAttribute("download")||0!=o.href.indexOf(d+"/")||o.href.indexOf("#")>-1&&n(o.href)==T||(A?!a(o):i(o))||(o.addEventListener("touchstart",c),x?o.addEventListener("mousedown",l):o.addEventListener("mouseover",f),o.addEventListener("click",u));if(!r){var v,m,p,g,y=t.body.getElementsByTagName("script");for(h=0,j=y.length;j>h;h++)v=y[h],v.hasAttribute("data-no-instant")||(m=t.createElement("script"),v.src&&(m.src=v.src),v.innerHTML&&(m.innerHTML=v.innerHTML),p=v.parentNode,g=v.nextSibling,p.removeChild(v),p.insertBefore(m,g))}}function p(t){!x&&"display"in D&&+new Date-(D.start+D.display)<100||(w&&(clearTimeout(w),w=!1),t||(t=E),(!I||t!=H&&!S)&&(I=!0,S=!1,H=t,N=!1,B=!1,D={start:+new Date},o("fetch"),L.open("GET",t),L.send()))}function g(t){return"display"in D||(D.display=+new Date-D.start),w?H&&H!=t?void(e.href=t):(p(t),K.start(0,!0),o("wait"),void(S=!0)):!I||S?void(e.href=t):B?void(e.href=H):N?(C[T].scrollY=pageYOffset,d(),void s(O,N,H)):(K.start(0,!0),o("wait"),void(S=!0))}function y(){if(!T){if(!P)return void o("change",!0);for(var r=arguments.length-1;r>=0;r--){var i=arguments[r];i===!0?A=!0:"mousedown"==i?x=!0:"number"==typeof i&&(k=i)}T=n(e.href),C[T]={body:t.body,title:t.title,scrollY:pageYOffset};for(var a,d,l=t.head.children,r=l.length-1;r>=0;r--)a=l[r],a.hasAttribute("data-instant-track")&&(d=a.getAttribute("href")||a.getAttribute("src")||a.innerHTML,z.push(d));L=new XMLHttpRequest,L.addEventListener("readystatechange",v),m(!0),K.init(),o("change",!0),addEventListener("popstate",function(){var t=n(e.href);if(t!=T){if(!(t in C))return void(e.href=e.href);C[T].scrollY=pageYOffset,T=t,s(C[t].title,C[t].body,!1,C[t].scrollY)}})}}function b(t,e){W[t].push(e)}var T,E,w,L,A,x,k,M=navigator.userAgent,Y="createTouch"in t,C={},H=!1,O=!1,B=!1,N=!1,D={},I=!1,S=!1,z=[],W={fetch:[],receive:[],wait:[],change:[]},K=function(){function e(){d=t.createElement("div"),d.id="instantclick",l=t.createElement("div"),l.id="instantclick-bar",l.className="instantclick-bar",d.appendChild(l);var e=["Webkit","Moz","O"];if(f="transform",!(f in l.style))for(var n=0;3>n;n++)e[n]+"Transform"in l.style&&(f=e[n]+"Transform");var r="transition";if(!(r in l.style))for(var n=0;3>n;n++)e[n]+"Transition"in l.style&&(r="-"+e[n].toLowerCase()+"-"+r);var i=t.createElement("style");i.innerHTML="#instantclick{position:"+(Y?"absolute":"fixed")+";top:0;left:0;width:100%;pointer-events:none;z-index:2147483647;"+r+":opacity .25s .1s}.instantclick-bar{background:#29d;width:100%;margin-left:-100%;height:2px;"+r+":all .25s}",t.head.appendChild(i),Y&&(s(),addEventListener("resize",s),addEventListener("scroll",s))}function n(e,n){c=e,t.getElementById(d.id)&&t.body.removeChild(d),d.style.opacity="1",t.getElementById(d.id)&&t.body.removeChild(d),a(),n&&setTimeout(r,0),clearTimeout(u),u=setTimeout(i,500)}function r(){c=10,a()}function i(){c+=1+2*Math.random(),c>=98?c=98:u=setTimeout(i,500),a()}function a(){l.style[f]="translate("+c+"%)",t.getElementById(d.id)||t.body.appendChild(d)}function o(){return t.getElementById(d.id)?(clearTimeout(u),c=100,a(),void(d.style.opacity="0")):(n(100==c?0:c),void setTimeout(o,0))}function s(){d.style.left=pageXOffset+"px",d.style.width=innerWidth+"px",d.style.top=pageYOffset+"px";var t="orientation"in window&&90==Math.abs(orientation),e=innerWidth/screen[t?"height":"width"]*2;d.style[f]="scaleY("+e+")"}var d,l,f,c,u;return{init:e,start:n,done:o}}(),P="pushState"in history&&(!M.match("Android")||M.match("Chrome/"))&&"file:"!=e.protocol;return{supported:P,init:y,on:b}}(document,location);
},{}],2:[function(require,module,exports){
"use strict";function loadCSS(e,t,n){var o=window.document.createElement("link"),s=t||window.document.getElementsByTagName("script")[0];o.rel="stylesheet",o.href=e,o.media="only x",s.parentNode.insertBefore(o,s),setTimeout(function(){o.media=n||"all"})}function loadJS(e,t){var n=window.document.getElementsByTagName("script")[0],o=window.document.createElement("script");return o.src=e,n.parentNode.insertBefore(o,n),t&&(o.onload=t),o}function startCodeHighlighting(){for(var e=document.querySelectorAll("pre code"),t=0,n=e.length;n>t;t++)hljs.highlightBlock(e[t])}var disqusLoaded=!1,ic=require("./instantclick");ic.on("change",function(){function e(){0===window.pageYOffset?window.addEventListener("scroll",function e(){loadJS("//"+disqus_shortname+".disqus.com/embed.js"),window.removeEventListener("scroll",e)}):loadJS("//"+disqus_shortname+".disqus.com/embed.js")}require("./menu").setup(),require("./social").buildShareButtons(),loadCSS("//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css"),loadCSS("http://yandex.st/highlightjs/8.0/styles/vs.min.css"),loadJS("//yandex.st/highlightjs/8.0/highlight.min.js",startCodeHighlighting);var t=!!document.getElementById("comments");disqusLoaded&&t&&window.DISQUS&&document.getElementById("comments")&&window.DISQUS.reset({reload:!0}),!disqusLoaded&&t&&(window.disqus_shortname="bdadamcom",e(),disqusLoaded=!0)}),ic.init();
},{"./instantclick":1,"./menu":3,"./social":4}],3:[function(require,module,exports){
module.exports={setup:function(){var e=!0,t=document.getElementById("menu"),n=document.querySelector(".menu-icon");n.addEventListener("click",function(l){e?(t.style.display="block",n.children[0].textContent="close",e=!1):(t.style.display="none",n.children[0].textContent="menu",e=!0),l.preventDefault()})}};
},{}],4:[function(require,module,exports){
function buildShareBar(a){for(var e=encodeURIComponent(document.location.href.replace(document.location.search,"")),r="",t=0,l=links.length;l>t;t++){var n=links[t];r+=n.replace("##url##",e)}a.innerHTML=r}function addListener(a,e,r){a.addEventListener(e,r)}var tracking=require("./tracking"),links=['<a class="btn-share fb" href="https://www.facebook.com/sharer/sharer.php?u=##url##" target="_blank"><i class="fa fa-facebook"></i> Share</a>','<a class="btn-share tw" href="http://twitter.com/share?url=##url##" target="_blank"><i class="fa fa-twitter"></i> Tweet</a>','<a class="btn-share gp" href="https://plus.google.com/share?url=##url##" target="_blank"><i class="fa fa-google-plus"></i> Share</a>','<a class="btn-share li" href="http://www.linkedin.com/shareArticle?mini=true&url=##url##" target="_blank"><i class="fa fa-linkedin"></i> Share</a>','<a class="btn-share cm" href="#comments"><i class="fa fa-comment"></i> Comment</a>'];module.exports={buildShareButtons:function(){for(var a=document.querySelectorAll(".share-bar"),e=0,r=a.length;r>e;e++)buildShareBar(a[e]);for(var t=document.querySelectorAll(".btn-share"),e=0,r=t.length;r>e;e++){var l=t[e];addListener(l,"click",function(){var a=this.className.replace("btn-share ","");tracking.trackEvent("Social","Share",a)})}}};
},{"./tracking":5}],5:[function(require,module,exports){
module.exports={trackEvent:function(n,e,o,t){window.ga&&window.ga("send","event",n,e,o,t)}};
},{}]},{},[2])</script><script data-no-instant>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');</script><script>if (location.hostname !== 'localhost') {
    ga('create', 'UA-47485340-1', 'bdadam.com');
    ga('send', 'pageview', location.pathname + location.search);

    ga('create', 'UA-49233936-1', 'bdadam.com', { name: 'x'});
    ga('x.send', 'pageview', location.pathname + location.search);
}</script></body></html>