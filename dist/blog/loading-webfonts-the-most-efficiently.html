<!doctype html><html lang="en"><head><meta charset="utf-8"><title>Loading webfonts the most efficiently on responsive sites</title><meta property="og:description" content="The times are over when every website just used Arial, Verdana, Garamond or Times New Roman for rendering the text, because these were the only reliable fonts which were installed on almost any computer. Nowadays webfonts are spread all over the internet, but we still don&#x27;t really know, how to load them efficiently. Here is a case study about loading Source Sans Pro the most efficiently."><script>(function(){
        function addFont() {
            var style = document.createElement('style');
            style.textContent = localStorage.sourceSansPro;
            style.rel = 'stylesheet';
            document.head.appendChild(style);
        }

        try {
            if (localStorage.sourceSansPro) {
                addFont();
            } else {
                var request = new XMLHttpRequest();
                request.open('GET', '/static/source-sans-pro.woff.css', true);

                request.onload = function() {
                    if (request.status >= 200 && request.status < 400) {
                        localStorage.sourceSansPro = request.responseText;
                        addFont();
                    }
                }

                request.send();
            }
        } catch(ex) {}
    }());</script><link href="/static/main.css?a7cfdbe1" rel="stylesheet"><link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/bdadamcom"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Adam Beres-Deak"><meta name="viewport" content="width=device-width"><link rel="apple-touch-icon" sizes="57x57" href="/static/img/favico/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="114x114" href="/static/img/favico/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="72x72" href="/static/img/favico/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="144x144" href="/static/img/favico/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="60x60" href="/static/img/favico/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="120x120" href="/static/img/favico/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="76x76" href="/static/img/favico/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="152x152" href="/static/img/favico/apple-touch-icon-152x152.png"><link rel="icon" type="image/png" href="/static/img/favico/favicon-196x196.png" sizes="196x196"><link rel="icon" type="image/png" href="/static/img/favico/favicon-160x160.png" sizes="160x160"><link rel="icon" type="image/png" href="/static/img/favico/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/png" href="/static/img/favico/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/static/img/favico/favicon-16x16.png" sizes="16x16"><meta name="msapplication-TileColor" content="#aa2211"><meta name="msapplication-TileImage" content="/static/img/favico/mstile-144x144.png"></head><body><nav><div class="container main"><a class="brand" href="/">bdadam.com</a> <a class="menu-icon" href="#"><span class="menu-icon">menu</span></a><div id="menu"><a href="/javascript-goodies.html">JavaScript Goodies</a> <a href="/about.html">Contact</a></div></div></nav><article class="container main full-post"><h1>Loading webfonts the most efficiently on responsive sites</h1><p class="silent">8th October 2014 | by <a href="/about.html">Adam Beres-Deak</a> | <i class="fa fa-tags"></i> webfonts, loading, perfmatters</p><div class="abstract"><p>The times are over when every website just used Arial, Verdana, Garamond or Times New Roman for rendering the text, because these were the only reliable fonts which were installed on almost any computer. Nowadays webfonts are spread all over the internet, but we still don&#x27;t really know, how to load them efficiently. Here is a case study about loading Source Sans Pro the most efficiently.</p></div><h2 id="tldr">TLDR</h2><ol><li>Only serve fonts in woff format</li><li>Other browsers get the old &quot;websafe&quot; fonts</li><li>Download the font, optimize it</li><li>Serve the fonts yourself</li><li>Serve them as CSS files - base64 encoded data URIs</li><li>If the user doesn&#39;t have the font, load it asynchronously and store in localStorage</li><li>Otherwise load it from localStorage without accessing the server</li><li>Have fun because your site renders much faster and your users have a much better usability experience</li></ol><h2 id="1-browser-support">1. Browser support</h2><p>According to <a href="http://caniuse.com/#search=woff">caniuse</a>, 84% of users&#39; browsers support <code>woff</code> format. The only exceptions are the usual old browsers - IE8 and old stock android browsers. Therefore it is mostly enough to only provide webfonts for those browsers which support the <code>woff</code> format. The old browsers should only show a fallback font like the ones mentioned above. They will also be thankful for having better performance browsing your website. Just try to find something which fits in your design.</p><h2 id="2-don-t-use-external-providers-like-google-fonts-or-typekit">2. Don&#39;t use external providers like Google Fonts or Typekit</h2><p>They either cause many extra blocking requests or annoying blinking if loading asynchronously. We&#39;ll see shortly that there is a much better way of serving webfonts.</p><h2 id="3-the-licence-matters">3. The licence matters</h2><p>Choose a webfont which you can serve yourself. Unfortunately not every licence allows this. Fortunately there are many which do - like the open source ones. Some of them are Open Sans or Source Sans Pro. When you found your font, download the &quot;binary&quot; files (otf or ttf).</p><h2 id="4-optimizing-reducing-size-generating-the-css">4. Optimizing, reducing size, generating the CSS</h2><p>Head on over to the <a href="http://www.fontsquirrel.com/tools/webfont-generator">Font Squirrel Webfont Generator</a>.</p><p>When choosing expert mode we can choose to remove some charsets. You have to decide which character sets you really need. Is your content only in english? Then you just need a basic subset. Is your content in chineese? Then you most probably need everything.</p><p>It is important to choose the option to generate CSS files which contains the base64 encoded fonts. This file is what we really need.</p><h2 id="5-serving-the-css-file">5. Serving the CSS file</h2><p>This file is going to be quite large (up to 100-300 kB) depending on your choice on charsets and the other options. Therefore it is important to gzip it correctly and setting strong cacheability.</p><p>Fortunately you are going to serve this file only once for your visitors. The first time, when the user doesn&#39;t have the font file, you download it asynchronously and store it in localStorage. This time users with slower connections can see when the browsers repaints the fallback fonts with your webfonts, but it only happens at most once. Many users won&#39;t notice anything at all.</p><p>From the second page load on you just load the CSS file from the localStorage. Which is reasonably fast. The users won&#39;t see any blinking, because all the operations are synchronous, but only take a couple of milliseconds.</p><h2 id="6-show-me-the-code">6. Show me the code</h2><p>Since we store the file in localStorage this technique only needs client side code. Here you are.</p><pre><code class="language-JavaScript">(function(){
    function addFont() {
        var style = document.createElement(&#39;style&#39;);
        style.textContent = localStorage.sourceSansPro;
        style.rel = &#39;stylesheet&#39;;
        document.head.appendChild(style);
    }

    try {
        if (localStorage.sourceSansPro) {
            // The font is in localStorage, we can load it directly
            addFont();
        } else {
            // We have to first load the font file asynchronously
            var request = new XMLHttpRequest();
            request.open(&#39;GET&#39;, &#39;/path/to/source-sans-pro.woff.css&#39;, true);

            request.onload = function() {
                if (request.status &gt;= 200 &amp;&amp; request.status &lt; 400) {
                    // We save the file in localStorage
                    localStorage.sourceSansPro = request.responseText;

                    // ... and load the font
                    addFont();
                }
            }

            request.send();
        }
    } catch(ex) {}
}());</code></pre><h2 id="7-what-did-we-achieve">7. What did we achieve</h2><ol><li>Eliminated at least one, but usually many blocking requests</li><li>No blinking for the user when the fallback font gets replaced by the wbfont</li><li>Faster render time on the first page request</li><li>Better score on Google Page Speed Insights and WebPageTest.org</li></ol><h2 id="8-see-it-in-action">8. See it in action</h2><p>This technique is used on my blog. You can test it with your smartphone, tablet or laptop. It&#39;s fast, I promise. :)</p><a class="silent" href="https://plus.google.com/116380265342833844173?rel=author">by Adam Beres-Deak</a><p class="share-bar"></p><a id="comments"></a><div id="disqus_thread"></div><h4>Latest blog posts</h4><p><a href="/blog/optimistic-page-loading-with-instantclick-io.html">Loading web pages really fast - optimistic page loading with Instantclick.io <span class="muted"><small>8th October 2014</small></span></a></p><p><a href="/blog/generating-sound-effects-with-client-side-javascript.html">Generating sound effects with client side JavaScript <span class="muted"><small>6th April 2014</small></span></a></p><p><a href="/blog/static-site-generation-boilerplate.html">Boilerplate for static site generation <span class="muted"><small>25th March 2014</small></span></a></p><p><a href="/blog/automatically-loading-grunt-tasks-with-matchdep.html">Automatically loading Grunt tasks with matchdep <span class="muted"><small>11th March 2014</small></span></a></p></article><footer><p>Adam Beres-Deak &copy; 2014 <span class="social-links"><a href="mailto:me@bdadam.com"><i class="fa fa-envelope"></i></a>&nbsp;&nbsp; <a href="http://github.com/bdadam" rel="external,nofollow"><i class="fa fa-github"></i></a>&nbsp;&nbsp; <a href="https://twitter.com/bdadamm" rel="external,nofollow"><i class="fa fa-twitter"></i></a>&nbsp;&nbsp; <a href="https://www.xing.com/profile/Adam_BeresDeak" rel="external,nofollow"><i class="fa fa-xing"></i></a>&nbsp;&nbsp; <a href="https://plus.google.com/116380265342833844173?rel=author"><i class="fa fa-google-plus-square"></i></a></span> <a rel="external" href="http://feeds.feedburner.com/bdadamcom">RSS</a></p><p class="silent container">Except where otherwise noted, content on this site is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="external,noindex,nofollow">Creative Commons Attribution 4.0 International license</a>. Code samples are licensed under the MIT license.</p></footer><script data-no-instant src="/static/main.js?43c58e8a" async></script><script data-no-instant>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');</script><script>if (location.hostname !== 'localhost') {
    ga('create', 'UA-47485340-1', 'bdadam.com');
    ga('send', 'pageview', location.pathname + location.search);

    ga('create', 'UA-49233936-1', 'bdadam.com', { name: 'x'});
    ga('x.send', 'pageview', location.pathname + location.search);
}</script></body></html>