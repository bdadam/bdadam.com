<!doctype html>
<html>
<head>
    <meta name="charset" content="utf-8"/>
    <title>A simple PubSub module in JavaScript</title>
    
    <meta property="og:description" content="I have always been a fan of simple things, such as the PubSub pattern. A few weeks ago I discovered this pattern again, when I was looking for a way to separate some JavaScript modules which don&#x27;t really have to know about each other but have to have some sort of communication."/>

    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700&subset=latin,latin-ext' rel='stylesheet'>
    <link href="/static/main.css?39a9030d" rel="stylesheet"/>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/bdadamcom"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="author" content="Adam Beres-Deak"/>
    <meta name="viewport" content="width=device-width"/>
    <link rel="apple-touch-icon" sizes="57x57" href="/static/img/favico/apple-touch-icon-57x57.png"/>
<link rel="apple-touch-icon" sizes="114x114" href="/static/img/favico/apple-touch-icon-114x114.png"/>
<link rel="apple-touch-icon" sizes="72x72" href="/static/img/favico/apple-touch-icon-72x72.png"/>
<link rel="apple-touch-icon" sizes="144x144" href="/static/img/favico/apple-touch-icon-144x144.png"/>
<link rel="apple-touch-icon" sizes="60x60" href="/static/img/favico/apple-touch-icon-60x60.png"/>
<link rel="apple-touch-icon" sizes="120x120" href="/static/img/favico/apple-touch-icon-120x120.png"/>
<link rel="apple-touch-icon" sizes="76x76" href="/static/img/favico/apple-touch-icon-76x76.png"/>
<link rel="apple-touch-icon" sizes="152x152" href="/static/img/favico/apple-touch-icon-152x152.png"/>
<link rel="icon" type="image/png" href="/static/img/favico/favicon-196x196.png" sizes="196x196"/>
<link rel="icon" type="image/png" href="/static/img/favico/favicon-160x160.png" sizes="160x160"/>
<link rel="icon" type="image/png" href="/static/img/favico/favicon-96x96.png" sizes="96x96"/>
<link rel="icon" type="image/png" href="/static/img/favico/favicon-32x32.png" sizes="32x32"/>
<link rel="icon" type="image/png" href="/static/img/favico/favicon-16x16.png" sizes="16x16"/>
<meta name="msapplication-TileColor" content="#aa2211"/>
<meta name="msapplication-TileImage" content="/static/img/favico/mstile-144x144.png"/>
</head>
<body>
<nav>
    <div class="container main">
        <a class="brand" href="/">bdadam.com</a>
        <a class="menu-icon" href="#"><span class="menu-icon">menu</span></a>

        <div id="menu">
            <a href="/javascript-goodies.html">JavaScript Goodies</a>
            <a href="/about.html">Contact</a>
        </div>
    </div>
</nav>


<article class="container main full-post">
    <h1>A simple PubSub module in JavaScript</h1>
    <p class="silent">
        3rd January 2014
        | by <a href="/about.html">Adam Beres-Deak</a>
        
            | <i class="fa fa-tags"></i> javascript,  modules 
        
    </p>

    <div class="abstract">
    <p>I have always been a fan of simple things, such as the PubSub pattern. A few weeks ago I discovered this pattern again, when I was looking for a way to separate some JavaScript modules which don&#x27;t really have to know about each other but have to have some sort of communication.</p>

    </div>

    <h2 id="tldr">TLDR</h2>
<p>I believe that publish/subscribe (PubSub) is a very powerfull pattern. Therefore I have recently open sourced my implementation of it in JavaScript. The full source code can be found on GitHub: <a href="https://github.com/bdadam/PubSub" rel="external,nofollow">github.com/bdadam/PubSub</a>.
It&#39;s completely dependency-free and very small (under 1kb).</p>
<h2 id="what-is-pubsub-">What is PubSub?</h2>
<blockquote>
<p>In software architecture, publishâ€“subscribe is a messaging pattern where senders of messages, called publishers, do not program the messages to be sent directly to specific receivers, called subscribers. Instead, published messages are characterized into classes, without knowledge of what, if any, subscribers there may be. Similarly, subscribers express interest in one or more classes, and only receive messages that are of interest, without knowledge of what, if any, publishers there are.
Pub/sub is a sibling of the message queue paradigm, and is typically one part of a larger message-oriented middleware system.
<small>Source: <a href="http://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">Wikipedia</a></small></p>
</blockquote>
<h2 id="differences-between-dom-events-and-pubsub">Differences between DOM events and PubSub</h2>
<p>PubSub is very similar to the DOM events, except: there is only one object which fires events and accepts listeners.
When using DOM events, a listener is registered on the DOM node which fires the event.</p>
<pre class="prettyprint lang-js"><code>document.getElementById('someId').addEventListener('click', function() { /* event listener */ });
</code></pre>

<p>In a <em>PubSub</em> architecture a publisher doesn&#39;t know its subscribers and a message receiver doesn&#39;t know where the message comes from. Both parties only know a mediator object which handles the broadcasting of the messages.</p>
<pre class="prettyprint lang-js"><code>// PubSub is the global mediator object

PubSub.subscribe('anEvent', function(eventName, eventData) {
    console.log(eventName); // "anEvent"
    console.log(eventData.something); // 1
    console.log(eventData.someOtherThing); // 2
});

PubSub.publish('anEvent', { something: 1, someOtherThing: 2 });
</code></pre>

<h2 id="the-power-of-pubsub">The power of PubSub</h2>
<p>This pattern allows us to decouple modules from each other. E.g. think of an online shop, where users can add products to their carts. When adding a product, the website usually has to do some things:</p>
<ul>
<li>update number of items</li>
<li>update total price</li>
<li>do some tracking (e.g. Google Analytics)</li>
<li>highlight the newly added product</li>
<li>maybe play a small animation or even some sound effect (don&#39;t do it)</li>
<li>etc.</li>
</ul>
<p>If a customer clicks on the &quot;Add to cart&quot; button, the button sends a message with the corresponding product as a payload. All the other components can listen to this event and act accordingly (update shopping cart, play animation, track it in Google Analytics and so on).</p>
<h2 id="are-there-any-disadvantages-">Are there any disadvantages?</h2>
<p>Yes, there are indeed. All the disadvantages come from the main advantage: publishers are decoupled from subscribers. This means:</p>
<ol>
<li>There is no guarantee that a message is delivered. PubSub is a fire and forget pattern.</li>
<li>The publisher doesn&#39;t know, when a subscriber stops working.</li>
</ol>
<h2 id="what-does-all-this-look-like-in-javascript-code-">What does all this look like in JavaScript code?</h2>
<pre class="prettyprint lang-js"><code >// What the button does
$("#addProductButton").click(function() {
    PubSub.publish("productAdded", {
        product: {
            id: 1234,
            name: 'A Super Product',
            price: 9900 // in cents
        },
        user: {
            country: "DE",
            loggedIn: true,
            membershipStatus: "premium"
        }
    });
});

// Total price module increases the displayed total price when a product is added
PubSub.subscribe('productAdded', function(eventData) {
    increaseTotalPrice(eventData.product.price);
});

// Play the sound when Mario collects a coin
PubSub.subscribe('productAdded', function() {
    playSound('mario-coin');
});

// Tracking module
PubSub.subscribe('productAdded', function(eventData) {
    _gaq.push([
        '_trackEvent',
        'Products',
        'Buy',
        eventData.product.name,
        eventData.product.price
    ]);
});
</code></pre>

<h2 id="how-to-install-it-">How to install it?</h2>
<p>If you use bower, just execute <code>bower install pubsub</code> and then include pubsub.min.js in your code. E.g:  <code>&lt;script src=&quot;/bower_components/pubsub/pubsub.min.js&quot;&gt;&lt;/script&gt;</code></p>
<p>If you don&#39;t use bower then you can download <a href="https://raw.github.com/bdadam/PubSub/master/pubsub.min.js">pubsub.min.js</a> and include it. E.g.:
<code>&lt;script src=&quot;/libs/pubsub/pubsub.min.js&quot;&gt;&lt;/script&gt;</code></p>
<p>You can also use it with require-js:</p>
<pre><code class="language-javascript">require([<span class="string">'pubsub'</span>], <span class="function"><span class="keyword">function</span><span class="params">(PubSub)</span> {</span>
    console.log(<span class="keyword">typeof</span> PubSub.publish); <span class="comment">// "function"</span>
    console.log(<span class="keyword">typeof</span> PubSub.subscribe); <span class="comment">// "function"</span>
    console.log(<span class="keyword">typeof</span> PubSub.unsubscribe); <span class="comment">// "function"</span>

    <span class="comment">/* Please note: when using require js, the PubSub module doesn't register itself as a global object */</span>
    console.log(<span class="keyword">typeof</span> window.PubSub); <span class="comment">// "undefined"</span>
});</code></pre>
<p>I think I am not the only one, who loves the simplicity and elegance of PubSub. If you do it as well, please consider using my implementation.
It&#39;s free and it&#39;s published under the MIT license.</p>


    <a class="silent" href="https://plus.google.com/116380265342833844173?rel=author">by Adam Beres-Deak</a>

    <p class="share-bar"></p>

    <a id="comments"></a>

    <div id="disqus_thread"></div>

    <h4>Latest blog posts</h4>
    
        
            <p><a href="/blog/generating-sound-effects-with-client-side-javascript.html">Generating sound effects with client side JavaScript <span class="muted"><small>6th April 2014</small></span></a></p>
        
    
        
            <p><a href="/blog/static-site-generation-boilerplate.html">Boilerplate for static site generation <span class="muted"><small>25th March 2014</small></span></a></p>
        
    
        
            <p><a href="/blog/automatically-loading-grunt-tasks-with-matchdep.html">Automatically loading Grunt tasks with matchdep <span class="muted"><small>11th March 2014</small></span></a></p>
        
    
        
            <p><a href="/blog/simple-usability-trick-for-google-maps.html">A simple usability trick for Google Maps <span class="muted"><small>10th March 2014</small></span></a></p>
        
    
        
            <p><a href="/blog/switching-background-color-with-gimp.html">Switching background color of an image with Gimp <span class="muted"><small>2nd March 2014</small></span></a></p>
        
    
</article>


<footer>
    <p>
        Adam Beres-Deak &copy; 2014

        <span class="social-links">
            <a href="mailto:me@bdadam.com"><i class="fa fa-envelope"></i></a>&nbsp;&nbsp;
            <a href="http://github.com/bdadam" rel="external,nofollow"><i class="fa fa-github"></i></a>&nbsp;&nbsp;
            <a href="https://twitter.com/bdadamm" rel="external,nofollow"><i class="fa fa-twitter"></i></a>&nbsp;&nbsp;
            <a href="https://www.xing.com/profile/Adam_BeresDeak" rel="external,nofollow"><i class="fa fa-xing"></i></a>&nbsp;&nbsp;
            <a href="https://plus.google.com/116380265342833844173?rel=author"><i class="fa fa-google-plus-square"></i></a>
        </span>

        <a rel="external" href="http://feeds.feedburner.com/bdadamcom">RSS</a>
    </p>
    <p class="silent container">
        Except where otherwise noted, content on this site is licensed under a
        <a href="http://creativecommons.org/licenses/by/4.0/" rel="external,noindex,nofollow">Creative Commons Attribution 4.0 International license</a>.
        Code samples are licensed under the MIT license.
    </p>
</footer>
<script data-no-instant src="/static/main.js?43c58e8a" async></script>
<script data-no-instant>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');</script>
<script>
if (location.hostname !== 'localhost') {
    ga('create', 'UA-47485340-1', 'bdadam.com');
    ga('send', 'pageview', location.pathname + location.search);

    ga('create', 'UA-49233936-1', 'bdadam.com', { name: 'x'});
    ga('x.send', 'pageview', location.pathname + location.search);
}
</script>
</body>
</html>